   const l=lines[i];
    if(/^#{1,2} /.test(l)){html+=`<h2>${inl(l.replace(/^#+\s/,''))}</h2>`;}
    else if(l.startsWith('### ')){html+=`<h3>${inl(l.slice(4))}</h3>`;}
    else if(l.startsWith('#### ')){html+=`<h4>${inl(l.slice(5))}</h4>`;}
    else if(l.startsWith('- ')||l.startsWith('• ')){html+='<ul>';while(i<lines.length&&(lines[i].startsWith('- ')||lines[i].startsWith('• '))){html+=`<li>${inl(lines[i].slice(2))}</li>`;i++;}html+='</ul>';continue;}
    else if(/^\d+\. /.test(l)){html+='<ol>';while(i<lines.length&&/^\d+\. /.test(lines[i])){html+=`<li>${inl(lines[i].replace(/^\d+\. /,''))}</li>`;i++;}html+='</ol>';continue;}
    else if(l.startsWith('> ')){html+=`<blockquote>${inl(l.slice(2))}</blockquote>`;}
    else if(l.includes('⚠️')){html+=`<div class="caution">${inl(l)}</div>`;}
    else if(l.trim()){html+=`<p>${inl(l)}</p>`;}
    i++;
  }
  return html;
}
function esc(t){return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function inl(t){return esc(t).replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>').replace(/_(.+?)_/g,'<em>$1</em>');}
function closeModal(id){document.getElementById(id).style.display='none';}
document.querySelectorAll('.overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.style.display='none';}));
function showToast(msg){document.querySelector('.toast')?.remove();const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),3200);}
init();
</script>
